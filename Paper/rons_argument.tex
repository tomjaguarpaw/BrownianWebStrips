{
\section{\TODO{Convergence result}{Better title}}
\label{sec:proof-of-lem:resamplede-to-sampled}

\newcommand{\bandwidth}{\delta}
\newcommand{\rotproc}{Y}

\newcommand{\union}{\cup}
\renewcommand{\L}{L^+ \union L^-}
\newcommand{\Le}{L^\epsilon}

This section is devoted to proving Lemma
\ref{lem:resamplede-to-sampled}, i.e.\ that
\statementoflemresampledetosampled.  This statment only depends on the
(joint) distribution of $(\sampled, \resamplede)$ so let us describe this
distribution as a two-dimensional random process.

...

\begin{definition}
  We say $Y$ is \emph{absorbed} when it hits $\L$, or it hits $\Le$
  when it is in an absorbing state.
\end{definition}

...

It will simplify notation to work with the process $\rotproc =
(\sampled + \resamplede, \sampled - \resamplede)$ which is $(\sampled,
\resamplede)$ rotated clockwise about the origin by $\pi / 4$ radians (and enlarged by a factor of
$\sqrt{2}$, but the enlargement will be irrelevant).

Write $(\rotproc^1, \rotproc^2) = Y$.

Then \statementoflemresampledetosampled{} is equivalent to $\rotproc^2
\toinP 0$ as $\epsilon \to 0$.
Described less formally, this is $\rotproc$ staying close to the
horizontal axis during bounded time intervals with high probability.
By the scale-invariance properties of Brownian motion, proving the
convergence uniformly on the interval $[0,1]$ is as good as proving it
uniformly for every bounded interval.  Thus it will suffice to prove that
\[\text{
  for all $\delta > 0$, \, $\P(\sup_{t \in [0,1]} |Y^2_t| \ge \delta) \to 0$ as $\epsilon
  \to 0$.
}\]

\newcommand{\boundarylines}{A}

A further restatement will make our goal clearer.  \FIXME{}{Introduce
  $\boundarylines$}.

\begin{lemma}
  \label{lem:hit-boundary-lines-o1}
  The probability that before time $1$, $Y$ has hit $\boundarylines$
  is $o(1)$.
\end{lemma}

To summarise the section so far, we have demonstrated that Lemma
\ref{lem:resamplede-to-sampled}, i.e.\ that
\statementoflemresampledetosampled, is equivalent to Lemma
\ref{lem:hit-boundary-lines-o1}.  We will now provide a further step
in proving the latter.

\newcommand{\farpoint}{(P,0)}
\newcommand{\probhitboundaryis}[1]{Fix $P > 0$.  The probability that $Y$
  hits $\boundarylines$ before $\farpoint$ is #1}

\begin{lemma}
  \label{lem:prob-hit-boundary-o1}
  \probhitboundaryis{$o(1)$}
\end{lemma}

\newcommand{\origin}{(0,0)}

\begin{proof}[Proof of Lemma \ref{lem:hit-boundary-lines-o1} from
    Lemma \ref{lem:prob-hit-boundary-o1}]
  Fix $\eta > 0$.

  Choose $P$ so that the probability that standard Brownian motion
  travels from $0$ to $P$ in time less than $1$ is less than
  $\eta$.

  Choose $\epsilon$ such that the probability that $Y$ hits
  $\boundarylines$ before $\farpoint$ is less than $\eta$.

  Then the probability that $Y$ hits $\boundarylines$ before $\farpoint$
  or takes less time than $1$ to return from $\farpoint$ to $\origin$ is
  less than $2\eta$.
\end{proof}

Now all that remains is to prove Lemma \ref{lem:prob-hit-boundary-o1},
which we do in the following section through the notion of excursions.

\subsection{Excursions}

\newcommand{\excursionstart}{T}

\begin{definition*}
  Almost surely, the times at which $\rotproc = 0$ (which are stopping
  times) form an infinite discrete collection $\excursionstart_1 <
  \excursionstart_2 < \cdots$, say.  An excursion of $\rotproc$ is a
  time interval $[\excursionstart_i, \excursionstart_{i+1}]$ for some
  $i$.
\end{definition*}

\newcommand{\Omegaeloge}{\Omega(\epsilon\log\epsilon)}

\begin{lemma}
  \label{lem:Phitboundaryline}
  The probability that during an excursion $Y$ hits $\boundarylines$
  is $O(\epsilon)$.
\end{lemma}

\begin{lemma}
  \label{lem:Pabsorbedandtravelsfar}
  Fix $P > 0$.  The probability that during an excursion $Y$ hits $\farpoint$
  is $\Omegaeloge$.
\end{lemma}

\begin{lemma*}
  Fix $P > 0$.  The probability that during an excursion $Y$ hits $\farpoint$
  and does not hit $A$ is $\Omegaeloge$.
\end{lemma*}

\begin{proof}
  By Lemmas \ref{lem:Phitboundaryline} and
  \ref{lem:Pabsorbedandtravelsfar} the probability is at least
  $\Omegaeloge - O(\epsilon) = \Omegaeloge$.
\end{proof}

We are now in a position to prove something slightly stronger than
Lemma \ref{lem:prob-hit-boundary-o1}.

\begin{lemma*}
  \probhitboundaryis{$O(\frac{1}{\log\epsilon})$}
\end{lemma*}

\newcommand{\Oe}{O(\epsilon)}

\begin{proof}
  $Y$ consists of a sequence of excursions, each of which satisfies
  exactly one of the following conditions
  \begin{itemize}
  \item the excursion hits $\boundarylines$ (with probability
    $O(\epsilon$))
  \item the excursion does not hit $\boundarylines$ but does hit
    $\farpoint$ (with probability $\Omegaeloge$)
  \item the excursion does not hit $\boundarylines$ or $\farpoint$ before
    returning to $\origin$
  \end{itemize}
  When $Y$ returns to $\origin$ a new excursion begins, which is independent of
  the previous excursions.  Thus the probability that the first
  condition occurs before the second is exactly the probability of the
  first as fraction of the sum of their probabilities, that is
  \[
  \frac{\Oe}{\Omegaeloge + \Oe} = O\left(\frac{1}{\log\epsilon}\right)
  \]
\end{proof}

We conclude the section by providing the proofs of the two previously
stated lemmas.

\begin{proof}[Proof of Lemma \ref{lem:Phitboundaryline}]
Fix $\delta > 0$.  Consider the process $\rotproc$ run until either
it hits $A$ or is absorbed.  We will show that the probability it
hits $A$ is $O(\epsilon)$.

The only difficulty is that $\Le$ is sometimes absorbing and
sometimes not.

We analyse $\rotproc$ through the following state machine.

Consider $\rotproc$ at $(x,0) \in \Le$ (for some $x$) and $\Le$ being in
a non-absorbing state.  We will call this the start state.  From the
start state, $Y$ will eventually reach one of two mutually exclusive
states, according to which of the following occurs first

\newcommand{\intermediatelines}{I}

\begin{itemize}
\item $Y$ is absorbed
\item $Y$ reaches height $\pm\epsilon$
\end{itemize}

The probability of the first is bounded below by some constant $C > 0$
which does not depend on $x$ or $\epsilon$, and regardless of the
history of the state machine.

\newcommand{\stateintermediate}{Intermediate}

If the second happens we will say that the state machine goes into
state $\stateintermediate$.  From this state, the possible transitions
are according to which of the following occurs first

\begin{itemize}
\item $Y$ is absorbed
\item $Y$ hits $\boundarylines$
\item $Y$ hits $\Le$ when it is in a non-absorbing state
\end{itemize}

When the last happens we have returned to the start state.

The probability of the second transition is exactly equal to
$\epsilon/\delta$ regardless of the history of the state machine.

From this description it is straightforward to deduce that the
probability that the machine started when $Y = \origin$ (or indeed when
$Y = (x, 0)$ for any $x \in \Le$ and $\Le$ not absorbing) will hit
$\boundarylines$ before being absorbed is
bounded above by $\epsilon/\delta C$, so indeed this probability is
$O(\epsilon)$.
\end{proof}

\begin{proof}[Proof of Lemma \ref{lem:Pabsorbedandtravelsfar}]
We bound the probability that $\rotproc$ hits $\farpoint$ during an
excursion with a crude estimate which is nontheless sufficient.

From $\rotproc = \origin$ there is a positive probabilty, $C$ say, not
depending on $\epsilon$, that $\rotproc$ hits $Q = [0, \epsilon] \cross
\{\epsilon\}$ without having been absorbed.

From $\rotproc \in Q$ the hitting density on $L^+$ is at least $K
\frac{1}{\epsilon} \frac{1}{1 + (y/\epsilon)^2} dy$, where $K$ is a
normalising constant independent of $\epsilon$.

So the probability that $\rotproc$ started from some point in $Q$ hits $L^+$
between $\epsilon$ and $1$ and then travels to a point $\farpoint$ is at least
\[
\frac{K}{P} \int_{\epsilon}^{1} \frac{y/\epsilon}{1 + (y/\epsilon)^2}
\, dy
\]
which is
\[
\frac{K\epsilon}{2P} \log\left(\frac{1 + (1/\epsilon)^2}{2}\right)
\]
which is $\Omegaeloge$.
\end{proof}
}
