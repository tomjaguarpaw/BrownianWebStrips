{
\newpage

\section{Convergence of the perturbed process}
\label{sec:proof-of-lem:resamplede-to-sampled}

\newcommand{\bandwidth}{\delta}
\newcommand{\rotproc}{Y^\circ}
\FIXME{}{delete the above def}
\newcommand{\union}{\cup}
\renewcommand{\L}{L^+ \union L^-}
\newcommand{\Le}{L^\epsilon}
\newcommand{\statenoweb}{\text{state }1}
\newcommand{\statewebapart}{\text{state }2}
\newcommand{\statewebtogether}{\text{state }3}
\newcommand{\twodim}{Y}

The statement
\statementoflemresampledetosampled{} depends only on the
(joint) distribution of $\sampled$ and $\resamplede$. We therefore define $\twodim=(\sampled, \resamplede)$ (suppressing the $\epsilon$ dependence in the notation). Let us describe the distribution of $\twodim$
 as a two-dimensional random process.
We classify the behavior of the process according to three states, according to
the behavior of $\resamplede$ in respect to $\sampled$. If $\resamplede$ follows
$\bmweb$ we say it is in $\statenoweb$. If $\resamplede$ follows $\webnoargs$
and does not coalesce with $\sampled$ we say it is in $\statewebapart$. Finally,
if $\resamplede$ follows $\webnoargs$ coalescing with $\sampled$ we say it is in
$\statewebtogether$. \TODO{}{ohad: add figure} Observe that $\twodim$ always starts
in $\statewebtogether$. Further notice that from that from this state $\twodim$
can only transition to $\statenoweb$ after hitting the origin, as the coalesced
$\sampled$ and $\resamplede$ will continue together until they leave their
current half-plane. From $\statenoweb$ the process will transition to
$\statewebtogether$ as soon as $\resamplede$ leaves the $(-\epsilon,\epsilon)$
interval (i.e. $\twodim$ hits either of the $y=\pm\epsilon$ lines). From
$\statewebapart$ the process can either transition to $\statewebtogether$
if $\sampled$ and $\resamplede$ coalesce (i.e. $\twodim$ hits the line $x=y$)
or transition to $\statenoweb$ if $\resamplede$ hits $0$ (i.e. $\twodim$ hits
the $y=0$ line). The transition of $\twodim$ is summarized in figure
\ref{fig:twodimtranstab}.

\begin{figure}\label{fig:twodimtranstab}
\begin{center}
  \begin{tabular}{| l || c | c | c | c | c | }
    \hline
    State & Illustration & Law & Next & Trans. Cond. ($\resamplede$) & Trans. Cond. ($\twodim=(x,y)$) \\
    \hline
    \hline
    $\statenoweb$ & 2 & indep. & $\statewebapart$ & hits $\pm\epsilon$ & $x=\pm\epsilon$ \\
    \hline
    \multirow{2}{*}{$\statewebapart$} & \multirow{2}{*}{5} & \multirow{2}{*}{indep.} & $\statenoweb$ & hits $0$ & $x=0$ \\ \cline{4-6}
        &  &  & $\statewebtogether$ & hits $\sampled$ & $x=y$\\
    \hline
    $\statewebtogether$  & 8 & equal & $\statenoweb$ &  hits $0$ & $y=x=0$\\
    \hline
  \end{tabular}
\end{center}
\caption{States and transitions of $\twodim$}
\end{figure}
\TODO{}{Break lines in titles of two last columns}

We can now reduce Lemma \ref{lem:resamplede-to-sampled} and rephrase it in terms of $\twodim$:
\begin{lemma*}
$\P(\twodim_t \in \{(x,y) \ :\  |x-y|<\delta \} \text{ for all } t \in [0,1])\to1$ as $\epsilon\to 0$.
\end{lemma*}
The reduction of Lemma \ref{lem:resamplede-to-sampled} to the above
follows from the scale-invariance properties of Brownian motion. Those
imply that proving the convergence uniformly on the interval $[0,1]$
suffices to prove the convergence on every bounded time interval.
\newcommand{\boundarylines}{A}
We define $\boundarylines=\{(x,y) \ :\  |x-y|=\delta \}$.
The above lemma can now be rephrased as 
\begin{lemma*}
  The probability that before time $1$, $\twodim$ has hit $\boundarylines$
  is $o(1)$.
\end{lemma*}

This lemma can be further reduced to the following:
\newcommand{\farpoint}{(P,0)}
\newcommand{\probhitboundaryis}[1]{Fix $P > 0$.  The probability that $\twodim$
  hits $\boundarylines$ before $\farpoint$ is #1}

\begin{lemma}\label{lem:prob-hit-boundary-o1}
  \probhitboundaryis{$o(1)$}
\end{lemma}

\newcommand{\origin}{(0,0)}

\begin{proof}[The reduction proceeds as follows:]

  Let $\eta > 0$.

  Choose $P$ so that the probability that standard Brownian motion
  travels from $0$ to $P$ in time less than $1$ is less than
  $\eta$.

  Choose $\epsilon$ such that the probability that $\twodim$ hits
  $\boundarylines$ before $\farpoint$ is less than $\eta$.

  Then the probability that $\twodim$ hits $\boundarylines$ before $\farpoint$
  or takes less time than $1$ to return from $\farpoint$ to $\origin$ is
  less than $2\eta$.

  \FIXME{}{There needs to be some mention of time scaling here}
\end{proof}

In summary, we have reduced Lemma \ref{lem:resamplede-to-sampled} to
Lemma \ref{lem:prob-hit-boundary-o1}. We prove the latter in the
following section using the notion of excursions of $\twodim$.

\subsection{Excursions of $\twodim$}

\newcommand{\excursionstart}{T}

\begin{definition*}
  Almost surely, the times at which $\rotproc = 0$ (which are stopping
  times) form an infinite discrete collection $\excursionstart_1 <
  \excursionstart_2 < \cdots$, say.  An excursion of $\rotproc$ is a
  time interval $[\excursionstart_i, \excursionstart_{i+1}]$ for some
  $i$.
\end{definition*}

\newcommand{\Omegaeloge}{\Omega(\epsilon\log\epsilon)}

\newcommand{\probexcursion}[2]{The probability that during a given
  excursion #1 is #2.}

\begin{lemma}
  \label{lem:Phitboundaryline}
  \probexcursion{$Y$ hits $\boundarylines$}{$O(\epsilon)$}
\end{lemma}

\begin{lemma}
  \label{lem:Pabsorbedandtravelsfar}
  Fix $P > 0$. \probexcursion{$Y$ hits $\farpoint$}{$\Omegaeloge$}
\end{lemma}

\begin{lemma*}
  Fix $P > 0$.  \probexcursion{$Y$ hits $\farpoint$ and does not hit
    $A$}{$\Omegaeloge$}
\end{lemma*}

\begin{proof}
  By Lemmas \ref{lem:Phitboundaryline} and
  \ref{lem:Pabsorbedandtravelsfar} the probability is at least
  $\Omegaeloge - O(\epsilon) = \Omegaeloge$.
\end{proof}

We are now in a position to prove something slightly stronger than
Lemma \ref{lem:prob-hit-boundary-o1}.

\begin{lemma*}
  \probhitboundaryis{$O(\frac{1}{\log\epsilon})$}
\end{lemma*}

\newcommand{\Oe}{O(\epsilon)}

\begin{proof}
  $Y$ consists of a sequence of excursions, each of which satisfies
  exactly one of the following conditions
  \begin{itemize}
  \item the excursion hits $\boundarylines$ (with probability
    $O(\epsilon$))
  \item the excursion does not hit $\boundarylines$ but does hit
    $\farpoint$ (with probability $\Omegaeloge$)
  \item the excursion does not hit $\boundarylines$ or $\farpoint$ before
    returning to $\origin$
  \end{itemize}
  When $Y$ returns to $\origin$ a new excursion begins, which is independent of
  the previous excursions.  Thus the probability that the first
  condition occurs before the second is exactly the probability of the
  first as fraction of the sum of their probabilities, that is
  \[
  \frac{\Oe}{\Omegaeloge + \Oe} = O\left(\frac{1}{\log\epsilon}\right)
  \]
\end{proof}

We conclude the section by providing the proofs of the two previously
stated lemmas.

\begin{proof}[Proof of Lemma \ref{lem:Phitboundaryline}]
Fix $\delta > 0$.  Consider the process $\rotproc$ run until either
it hits $A$ or is absorbed.  We will show that the probability it
hits $A$ is $O(\epsilon)$.

The only difficulty is that $\Le$ is sometimes absorbing and
sometimes not.

We analyse $\rotproc$ through the following state machine.

Consider $\rotproc$ at $(x,0) \in \Le$ (for some $x$) and $\Le$ being in
a non-absorbing state.  We will call this the start state.  From the
start state, $Y$ will eventually reach one of two mutually exclusive
states, according to which of the following occurs first

\newcommand{\intermediatelines}{I}

\begin{itemize}
\item $Y$ is absorbed
\item $Y$ reaches height $\pm\epsilon$
\end{itemize}

The probability of the first is bounded below by some constant $C > 0$
which does not depend on $x$ or $\epsilon$, and regardless of the
history of the state machine.

\newcommand{\stateintermediate}{Intermediate}

If the second happens we will say that the state machine goes into
state $\stateintermediate$.  From this state, the possible transitions
are according to which of the following occurs first

\begin{itemize}
\item $Y$ is absorbed
\item $Y$ hits $\boundarylines$
\item $Y$ hits $\Le$ when it is in a non-absorbing state
\end{itemize}

When the last happens we have returned to the start state.

The probability of the second transition is exactly equal to
$\epsilon/\delta$ regardless of the history of the state machine.

From this description it is straightforward to deduce that the
probability that the machine started when $Y = \origin$ (or indeed when
$Y = (x, 0)$ for any $x \in \Le$ and $\Le$ not absorbing) will hit
$\boundarylines$ before being absorbed is
bounded above by $\epsilon/\delta C$, so indeed this probability is
$O(\epsilon)$.
\end{proof}

\begin{proof}[Proof of Lemma \ref{lem:Pabsorbedandtravelsfar}]
We bound the probability that $\rotproc$ hits $\farpoint$ during an
excursion with a crude estimate which is nontheless sufficient.

From $\rotproc = \origin$ there is a positive probabilty, $C$ say, not
depending on $\epsilon$, that $\rotproc$ hits $Q = [0, \epsilon] \cross
\{\epsilon\}$ without having been absorbed.

From $\rotproc \in Q$ the hitting density on $L^+$ is at least $K
\frac{1}{\epsilon} \frac{1}{1 + (y/\epsilon)^2} dy$, where $K$ is a
normalising constant independent of $\epsilon$.

So the probability that $\rotproc$ started from some point in $Q$ hits $L^+$
between $\epsilon$ and $1$ and then travels to a point $\farpoint$ is at least
\[
\frac{K}{P} \int_{\epsilon}^{1} \frac{y/\epsilon}{1 + (y/\epsilon)^2}
\, dy
\]
which is
\[
\frac{K\epsilon}{2P} \log\left(\frac{1 + (1/\epsilon)^2}{2}\right)
\]
which is $\Omegaeloge$.
\end{proof}
}
